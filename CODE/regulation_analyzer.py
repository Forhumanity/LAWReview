"""
法规审查分析器
从法规文档中提取和识别各类别的要求
"""
import json
from typing import Any, Dict

from base_analyzer import BaseAnalyzer


class RegulationAnalyzer(BaseAnalyzer):
    """法规审查分析器 - 从法规中提取要求"""
    
    def get_system_message(self) -> str:
        """获取系统消息"""
        return (
            "你是一名政府监管和合规专家，专门从法规文档中提取和识别监管要求。"
            "请仔细分析法规内容，识别其中涉及的各项要求和规定。"
            "所有回复必须使用中文，并返回有效的JSON格式。"
        )
    
    def create_analysis_prompt(self, document_content: str, framework_chunk: Dict[str, Any]) -> str:
        """创建法规审查的提示词"""
        return f"""你是一名监管合规专家，请分析以下法规文档，识别其中包含的监管要求。

法规文档内容：
{document_content}

请根据以下框架类别，识别法规中的相关要求：
{json.dumps(framework_chunk, ensure_ascii=False, indent=2)}

分析要求：
1. 对于框架中的每个类别，识别法规是否包含相关要求
2. 提取法规中的具体条款、要求和规定
3. 评估每项要求的重要性和强制性
4. 记录原文中的具体章节和条款号
5. 识别法规的适用范围和生效条件

请严格按照以下JSON格式返回结果：
{{
    "文档标题": "法规文档的标题",
    "颁布机构": "颁布该法规的政府机构",
    "生效日期": "法规生效日期",
    "详细分析": {{
        "类别名称": [
            {{
                "框架要求编号": 1,
                "框架要求名称": "框架中定义的要求名称",
                "法规覆盖情况": "完全覆盖/部分覆盖/未覆盖/不适用",
                "法规要求内容": [
                    {{
                        "条款编号": "第X条",
                        "具体要求": "法规中的具体要求内容",
                        "强制等级": "强制/推荐/指导",
                        "适用对象": "该要求适用的主体",
                        "原文内容": "法规原文摘录"
                    }}
                ],
                "实施要求": "法规对该要求的具体实施规定",
                "处罚措施": "违反该要求的处罚措施（如有）"
            }}
        ]
    }},
    "关键发现": [
        "法规中的重要发现和关键要求"
    ],
    "合规建议": [
        "基于法规要求的合规建议"
    ]
}}

请确保：
1. 准确识别法规中的所有相关要求
2. 保持原文的准确性，不要修改法规原文
3. 返回有效的JSON格式
4. 所有内容使用中文"""