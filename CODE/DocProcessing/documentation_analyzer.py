"""
文档审查分析器
检查企业文档是否满足监管框架要求
"""
import json
from typing import Any, Dict

from base_analyzer import BaseAnalyzer


class DocumentationAnalyzer(BaseAnalyzer):
    """文档审查分析器 - 检查文档是否满足要求"""
    
    def get_system_message(self) -> str:
        """获取系统消息"""
        return (
            "你是一名企业合规审查专家，专门评估企业文档是否满足监管要求。"
            "请仔细分析文档内容，判断其是否充分满足各项监管要求。"
            "所有回复必须使用中文，并返回有效的JSON格式。"
        )
    
    def create_analysis_prompt(self, document_content: str, framework_chunk: Dict[str, Any]) -> str:
        """创建文档审查的提示词"""
        return f"""你是一名合规审查专家，请评估以下企业文档是否满足监管框架要求。

企业文档内容：
{document_content}

监管框架要求：
{json.dumps(framework_chunk, ensure_ascii=False, indent=2)}

审查要求：
1. 评估文档是否充分覆盖框架中的每项要求
2. 识别文档中对应每项要求的具体内容
3. 评估内容的完整性、准确性和可执行性
4. 找出存在的差距和不足
5. 提供改进建议

请严格按照以下JSON格式返回结果：
{{
    "文档标题": "被审查文档的标题",
    "文档类型": "制度/流程/指南/其他",
    "审查日期": "YYYY-MM-DD",
    "详细分析": {{
        "类别名称": [
            {{
                "要求编号": 1,
                "要求名称": "框架中的要求名称",
                "满足程度": "完全满足/基本满足/部分满足/未满足",
                "满足程度评分": "1-10分",
                "文档对应内容": [
                    {{
                        "章节位置": "第X章第Y节",
                        "具体内容": "文档中的相关内容",
                        "内容评价": "优秀/良好/一般/不足"
                    }}
                ],
                "完整性评估": {{
                    "覆盖范围": "评估文档覆盖该要求的范围",
                    "详细程度": "高/中/低",
                    "可操作性": "强/中/弱"
                }},
                "存在问题": [
                    "识别的具体问题"
                ],
                "改进建议": [
                    "具体的改进建议"
                ]
            }}
        ]
    }},
    "总体评估": {{
        "合规成熟度": "1-5级",
        "覆盖率": "百分比",
        "主要优势": ["文档的主要优势"],
        "主要不足": ["文档的主要不足"]
    }},
    "优先改进事项": [
        {{
            "优先级": "高/中/低",
            "改进事项": "具体改进内容",
            "预期效果": "改进后的预期效果"
        }}
    ]
}}

请确保：
1. 客观评估文档内容，不要过度解读
2. 提供具体可行的改进建议
3. 返回有效的JSON格式
4. 所有内容使用中文"""